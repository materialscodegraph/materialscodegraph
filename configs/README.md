# Runner Configuration Files

This directory contains JSON configuration files that define how different computational tools (runners) operate within the MaterialsCodeGraph system.

## Configuration Structure

Each runner configuration file (e.g., `lammps.json`, `materialsproject.json`) follows a consistent structure:

### Basic Information
```json
{
  "name": "Runner Name",
  "description": "What this runner does"
}
```

### Skills
Each runner can support multiple computational skills:

```json
"skills": {
  "skill_name": {
    "description": "What this skill calculates",
    "required_parameters": ["param1", "param2"],
    "optional_parameters": ["param3", "param4"],
    "parameter_types": {
      "param1": "type_description",
      "param2": "list[float]"
    },
    "parameter_defaults": {
      "param3": "default_value"
    }
  }
}
```

### Input Templates
Templates for generating input files with placeholder substitution:

```json
"input_template": [
  "# Comment line",
  "command {parameter1}",
  "another_command {parameter2}"
]
```

Templates can be either:
- **Array format** (preferred): Clean, readable array of lines
- **String format**: Single string with newline characters

### Execution Configuration
```json
"execution": {
  "mode": "script",
  "script_inline": "python code here",
  "timeout": 60
}
```

## Available Runners

### LAMMPS (`lammps.json`)
Molecular dynamics simulations for materials properties.

**Skills:**
- `green_kubo`: Green-Kubo method for thermal conductivity calculation
- `nemd`: Non-equilibrium molecular dynamics

**Key Parameters:**
- `temperature`: List of temperatures in Kelvin
- `supercell`: Supercell dimensions [x, y, z]
- `timestep`, `equilibration_steps`, `production_steps`: Simulation parameters

### Materials Project (`materialsproject.json`)
Interface to the Materials Project database for crystal structures and properties.

**Skills:**
- `fetch_material`: Get material structure and properties by ID
- `search_materials`: Search for materials by criteria
- `get_structure`: Get detailed crystal structure

**Key Parameters:**
- `material_id`: Materials Project ID (e.g., "mp-149" for silicon)
- `formula`: Chemical formula for searches
- `include_structure`, `include_properties`: Control what data to fetch

## Parameter Types

The system supports various parameter types:

- **Scalars**: `"float"`, `"int"`, `"string"`
- **Lists**: `"list[float]"`, `"list[int]"`
- **Objects**: `"object"` for complex nested structures
- **Special**: `"list[int,int,int]"` for fixed-size arrays like supercells

## Workflow Integration

These configurations are used by the LLM-driven workflow planner to:

1. **Understand skills**: What each runner can calculate
2. **Extract parameters**: What parameters are needed from user input
3. **Generate input files**: Create appropriate input scripts
4. **Execute calculations**: Run with proper settings and timeouts
5. **Parse outputs**: Extract results from output files

## Dynamic Parameter Handling

The system features intelligent parameter handling:

- **Automatic defaults**: Uses `parameter_defaults` when values not specified
- **Type conversion**: Converts temperatures from Kelvin to simulation units
- **Multi-value support**: Handles arrays (e.g., multiple temperatures) in single runs
- **Logging**: Comprehensive logging of all parameter decisions

## Adding a New Runner

To add support for a new computational tool:

1. Create a new JSON file: `configs/toolname.json`
2. Define the structure following the examples above
3. Include at least one method with required parameters
4. Provide clear parameter types and defaults
5. Add input template if the tool needs input files

Example minimal configuration:

```json
{
  "name": "MyTool",
  "description": "Description of what MyTool does",
  "skills": {
    "calculate": {
      "description": "Main calculation skill",
      "required_parameters": ["input_param"],
      "parameter_types": {
        "input_param": "float"
      },
      "execution": {
        "mode": "script",
        "script_inline": "print('Running calculation with {input_param}')",
        "timeout": 30
      }
    }
  }
}
```

## Best Practices

1. **Clear naming**: Use descriptive skill names that indicate what they calculate
2. **Parameter documentation**: Include all parameters in `parameter_types`
3. **Sensible defaults**: Provide defaults for optional parameters
4. **Readable templates**: Use array format for multi-line templates
5. **Proper timeouts**: Set appropriate timeouts for each skill

## Notes

- The system no longer uses hardcoded workflow patterns
- All workflows are dynamically generated by LLM analysis
- Runners are discovered automatically from configuration files
- No need to register runners - just add the JSON file